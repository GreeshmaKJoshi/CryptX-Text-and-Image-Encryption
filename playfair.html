<!DOCTYPE html>
<html lang="="en">
<head>
  <meta charset="UTF-8" />
  <title>CryptX - Playfair Cipher</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    body {
      margin: 0;
      padding: 40px;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #2c3e50, #3498db);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h1 {
      font-size: 36px;
      margin-bottom: 30px;
    }

    textarea, input[type="text"] {
      width: 100%;
      max-width: 500px;
      padding: 12px;
      margin-bottom: 20px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
    }

    .buttons {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      background-color: #16a085;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background-color: #12876f;
    }

    .output {
      background-color: rgba(255, 255, 255, 0.15);
      padding: 20px;
      border-radius: 10px;
      max-width: 700px;
      width: 100%;
      word-wrap: break-word;
      margin-bottom: 20px;
    }

    .step {
      font-family: monospace;
      padding: 4px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    a {
      color: #00ffcc;
      text-decoration: none;
      margin-top: 20px;
    }

    a:hover {
      text-decoration: underline;
    }

    details {
      max-width: 700px;
      margin-top: 20px;
      background-color: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 8px;
    }

    summary {
      font-size: 18px;
      cursor: pointer;
    }

    summary:hover {
      color: #00ffcc;
    }
  </style>
</head>
<body>

  <h1>üóùÔ∏è Playfair Cipher</h1>

  <textarea id="inputText" rows="4" placeholder="Enter your message here..."></textarea>
  <input type="text" id="playfairKey" placeholder="Enter keyword (e.g. MONARCHY)" />

  <div class="buttons">
    <button onclick="encryptPlayfair()">Encrypt</button>
    <button onclick="decryptPlayfair()">Decrypt</button>
    <button onclick="animatePlayfair()">üîÅ Animate Encrypt</button>
    <button onclick="animatePlayfairDecrypt()">üîÅ Animate Decrypt</button>

  </div>

  <div class="output" id="outputText">Output will appear here...</div>
  <div class="output" id="animationBox"></div>

  <details>
    <summary><strong>üìò How Playfair Cipher Works</strong></summary>
    <p>
      The Playfair Cipher uses a 5√ó5 matrix of letters constructed from a keyword. 'J' is merged with 'I'.
    </p>
    <p>Rules:</p>
    <ul>
      <li>If letters are in the same row ‚Üí shift right</li>
      <li>If letters are in the same column ‚Üí shift down</li>
      <li>Otherwise ‚Üí rectangle swap</li>
    </ul>
  </details>

  <a href="encrypt.html">‚Üê Back to Algorithm Selection</a>

  <script>
    function generateMatrix(key) {
      key = key.toUpperCase().replace(/J/g, "I");
      const seen = new Set();
      let matrix = [];

      for (let char of key) {
        if (char >= 'A' && char <= 'Z' && !seen.has(char)) {
          matrix.push(char);
          seen.add(char);
        }
      }

      for (let i = 0; i < 26; i++) {
        let ch = String.fromCharCode(65 + i);
        if (ch === 'J') continue;
        if (!seen.has(ch)) {
          matrix.push(ch);
          seen.add(ch);
        }
      }

      return matrix;
    }

    function prepareText(text) {
      text = text.toUpperCase().replace(/[^A-Z]/g, "").replace(/J/g, "I");
      let prepared = "";
      for (let i = 0; i < text.length; i += 2) {
        let a = text[i];
        let b = text[i + 1] || "X";
        if (a === b) {
          prepared += a + "X";
          i--;
        } else {
          prepared += a + b;
        }
      }
      return prepared;
    }

    function findPosition(matrix, char) {
      const index = matrix.indexOf(char);
      return [Math.floor(index / 5), index % 5];
    }

    function encryptPlayfair() {
      const key = document.getElementById("playfairKey").value;
      const text = document.getElementById("inputText").value;
      const matrix = generateMatrix(key);
      const input = prepareText(text);

      let result = "";
      for (let i = 0; i < input.length; i += 2) {
        let [r1, c1] = findPosition(matrix, input[i]);
        let [r2, c2] = findPosition(matrix, input[i + 1]);

        if (r1 === r2) {
          result += matrix[r1 * 5 + (c1 + 1) % 5];
          result += matrix[r2 * 5 + (c2 + 1) % 5];
        } else if (c1 === c2) {
          result += matrix[((r1 + 1) % 5) * 5 + c1];
          result += matrix[((r2 + 1) % 5) * 5 + c2];
        } else {
          result += matrix[r1 * 5 + c2];
          result += matrix[r2 * 5 + c1];
        }
      }

      document.getElementById("outputText").innerText = result;
      logHistory("Playfair Encrypt", text, result);
    }

    function decryptPlayfair() {
      const key = document.getElementById("playfairKey").value;
      const text = document.getElementById("inputText").value;
      const matrix = generateMatrix(key);
      const input = prepareText(text);

      let result = "";
      for (let i = 0; i < input.length; i += 2) {
        let [r1, c1] = findPosition(matrix, input[i]);
        let [r2, c2] = findPosition(matrix, input[i + 1]);

        if (r1 === r2) {
          result += matrix[r1 * 5 + (c1 + 4) % 5];
          result += matrix[r2 * 5 + (c2 + 4) % 5];
        } else if (c1 === c2) {
          result += matrix[((r1 + 4) % 5) * 5 + c1];
          result += matrix[((r2 + 4) % 5) * 5 + c2];
        } else {
          result += matrix[r1 * 5 + c2];
          result += matrix[r2 * 5 + c1];
        }
      }

      document.getElementById("outputText").innerText = result;
      logHistory("Playfair Decrypt", text, result);
    }

    function animatePlayfair() {
      const key = document.getElementById("playfairKey").value;
      const text = document.getElementById("inputText").value;
      const matrix = generateMatrix(key);
      const input = prepareText(text);
      const box = document.getElementById("animationBox");
      box.innerHTML = "";

      let i = 0;

      function step() {
        if (i >= input.length) return;
        let a = input[i], b = input[i + 1];
        let [r1, c1] = findPosition(matrix, a);
        let [r2, c2] = findPosition(matrix, b);
        let resultA, resultB, rule = "";

        if (r1 === r2) {
          resultA = matrix[r1 * 5 + (c1 + 1) % 5];
          resultB = matrix[r2 * 5 + (c2 + 1) % 5];
          rule = "Same Row ‚Üí Shift Right";
        } else if (c1 === c2) {
          resultA = matrix[((r1 + 1) % 5) * 5 + c1];
          resultB = matrix[((r2 + 1) % 5) * 5 + c2];
          rule = "Same Column ‚Üí Shift Down";
        } else {
          resultA = matrix[r1 * 5 + c2];
          resultB = matrix[r2 * 5 + c1];
          rule = "Rectangle Swap";
        }

        const stepLine = document.createElement("div");
        stepLine.className = "step";
        stepLine.innerText = `Step ${i / 2 + 1}: ${a}(${r1},${c1}) & ${b}(${r2},${c2}) ‚Üí ${resultA}${resultB} | Rule: ${rule}`;
        box.appendChild(stepLine);
        i += 2;
        setTimeout(step, 500);
      }

      step();
    }

    function logHistory(type, input, output) {
      const logs = JSON.parse(localStorage.getItem('cryptxLogs') || '[]');
      logs.push({ type, input, output, date: new Date().toLocaleString() });
      localStorage.setItem('cryptxLogs', JSON.stringify(logs));
    }
    function animatePlayfairDecrypt() {
  const key = document.getElementById("playfairKey").value;
  const text = document.getElementById("inputText").value;
  const matrix = generateMatrix(key);
  const input = prepareText(text);
  const box = document.getElementById("animationBox");
  box.innerHTML = "";

  let i = 0;

  function step() {
    if (i >= input.length) return;
    let a = input[i], b = input[i + 1];
    let [r1, c1] = findPosition(matrix, a);
    let [r2, c2] = findPosition(matrix, b);
    let resultA, resultB, rule = "";

    if (r1 === r2) {
      resultA = matrix[r1 * 5 + (c1 + 4) % 5];
      resultB = matrix[r2 * 5 + (c2 + 4) % 5];
      rule = "Same Row ‚Üí Shift Left";
    } else if (c1 === c2) {
      resultA = matrix[((r1 + 4) % 5) * 5 + c1];
      resultB = matrix[((r2 + 4) % 5) * 5 + c2];
      rule = "Same Column ‚Üí Shift Up";
    } else {
      resultA = matrix[r1 * 5 + c2];
      resultB = matrix[r2 * 5 + c1];
      rule = "Rectangle Swap";
    }

    const stepLine = document.createElement("div");
    stepLine.className = "step";
    stepLine.innerText = `Step ${i / 2 + 1}: ${a}(${r1},${c1}) & ${b}(${r2},${c2}) ‚Üí ${resultA}${resultB} | Rule: ${rule}`;
    box.appendChild(stepLine);
    i += 2;
    setTimeout(step, 500);
  }

  step();
}

  </script>

</body>
</html>
